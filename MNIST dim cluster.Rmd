---
title: "MNIST dim cluster"
author: "Justin Lin"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(ggplot2)
library(dplyr)
library(MASS)
library(Rtsne)
library(dslabs)

source("Algorithms/dimensional clustering.R")
```


```{r}
n = 1000
p = 300
k = 30

data = read_mnist()$train
subsample = sample(1:60000, n)

Z = data$images[subsample,]
real_labels = data$labels[subsample]
pca = prcomp(Z, rank. = p)

tsne = Rtsne(pca$x, dims = 2, perplexity = 30)
```


```{r, fig.height=10}
labels = dimensional_clustering(X=pca$x, cutoff=c(0.3, 0.3, 0.3, rep(0.3, 297)), scale=FALSE)

vertex_labels = labels
  for (i in 2:nrow(labels)) {
    vertex_labels[i,] = labels[i,] + max(vertex_labels[1:(i-1),])
  }

plot_graph(labels)
```

```{r}
scores_list = list()
for (i in 2:10) {
  X = pca$x[,1:i]
  scores = vector()
  k = 2
  while (TRUE) {
    labels = kmeans(X, centers=k, iter.max=100, nstart=50)$cluster
    si = silhouette(x=labels, dist=dist(X))
    scores = c(scores, summary(si)$avg.width)
    k = k + 1
    
    if (length(scores) >= 3 && scores[length(scores)] < scores[length(scores)-1] && scores[length(scores)-1] < scores[length(scores)-2]) {
      break
    }
  }
  scores_list = c(scores_list, list(scores))
}

scores_list
```


```{r}
df = data.frame(pca_x=pca$x[,1], pca_y=pca$x[,2],
                tsne_x=tsne$Y[,1], tsne_y=tsne$Y[,2],
                real_labels=real_labels, labels=vertex_labels[4,])
```

```{r}
ggplot(data=df, aes(x=pca_x, y=pca_y, color=factor(real_labels))) + geom_point()
ggplot(data=df, aes(x=pca_x, y=pca_y, color=factor(labels))) + geom_point()

ggplot(data=df, aes(x=tsne_x, y=tsne_y, color=factor(real_labels))) + geom_point()
ggplot(data=df, aes(x=tsne_x, y=tsne_y, color=factor(labels))) + geom_point()
```